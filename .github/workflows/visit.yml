name: Auto Generate AI Summaries

on:
  # Triggered when new email arrives via webhook
  repository_dispatch:
    types: [new-email]

  # Backup: Run once a day at 8 AM Israel time (in case webhook fails)
  schedule:
    - cron: '0 5 * * *'  # 5 AM UTC = 8 AM Israel

jobs:
  trigger-ai-function:
    runs-on: ubuntu-latest

    steps:
      - name: Trigger AI Summary Generation
        run: |
          echo "ðŸ¤– Triggering AI summary generation..."
          echo "Event: ${{ github.event_name }}"

          response=$(curl -s -X POST \
            -H "X-API-Key: ${{ secrets.AUTO_AI_SECRET_KEY }}" \
            "https://hanahotplus-jlm.base44.app/functions/autoGenerateAISummariesMake")

          echo "ðŸ“Š Response:"
          echo "$response"

      - name: Complete
        run: echo "âœ… Function execution completed"
